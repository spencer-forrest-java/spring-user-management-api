# User Management API

Web API to perform CRUD operations on users and reset passwords.<br>
(Front-End - <a href="https://github.com/spencer-forrest-java/spring-user-management-client">User Management Client</a>)
<br><br>
For any questions contact me at
[Spencer Forrest](mailto:spencer.forrest.java@gmail.com?subject=[GitHub]%20User%20Management%20API).

#### Technologies used

1. Maven
2. Spring Boot
3. Spring Web MVC
4. Spring Data JPA
5. Spring Security
6. JWT (JSON Web Token)
7. Jackson
7. Hibernate
8. Java Mail API
9. MySQL
10. JDBC

### Description

API allows logged user with enough credentials to perform CRUD operations
on <a href="src/main/java/com/usermanagement/domain/User.java">User</a>.<br>
The user will receive a new autogenerated password by email upon registration or by having their password reset by an
admin or a super admin.<br>

### Endpoints

1. POST Methods:
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L56">"/user/register"</a><br>
        * Register a new user and assign the role "USER".
        * Autogenerated password is sent by email to the new user.
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L68">"/user/login"</a>
        * Authenticate user and generate a JWT token then put it in the response header.
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L84">"/user/add"</a>
        * Users with the authority "user:create" can add a new user which will have the role "USER".
          <br><br>
2. PUT Methods:
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L108">"/user/update"</a>
        * Users with the authority "user:update" can update an existing user.
        * An authenticated user can update his/her information except for his/her role.
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L139">"/user/update/profile-image"</a>
        * Users with the authority "user:update" can update the profile picture of an existing user.
        * An authenticated user can update his/her profile picture.
          <br><br>
3. GET Methods:
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L151">"/user/list"</a>
        * Users with the authority "user:read" can get a list of all users.
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L158">"/user/reset-password/{email}"</a>
        * Users with the role "ADMIN" or "SUPER_ADMIN" can reset a user password.
        * The password is autogenerated and sent by email to the user.
        * The password is encrypted in the database.
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L167">"
      /user/image/{userId}/{fileName}"</a>
        * Send user's profile picture. No credentials needed.
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L175">"
      /user/image/profile/{username}"</a>
        * Send user's autogenerated profile picture through https://robohash.org. No credentials needed.
          <br><br>
4. DELETE Methods:
    * <a href="src/main/java/com/usermanagement/controller/UserController.java#L192">"/user/delete/{username}"</a>
        * Users with the authority "user:delete" can remove a user.

### JSON format

<a href="src/main/java/com/usermanagement/dto/UserDto.java">User</a> received by the client.

```
{
    "userId": "2946839281",
    "username": "john",
    "email": "john@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "profileImageUrl": "http://localhost:8081/user/image/2946839281/2946839281.jpg",
    "joinDate": "2021-02-02T15:26:22.292+0000",
    "lastLoginDate": "2021-02-05T07:45:35.378+0000",
    "lastLoginDisplay": "2021-02-05T07:45:14.066+0000",
    "role": "ROLE_SUPER_ADMIN",
    "authorities": [
        "user:create",
        "user:read",
        "user:update",
        "user:delete"
    ],
    "active": true,
    "notLocked": true
}
```

<a href="src/main/java/com/usermanagement/dto/UserDto.java">User</a> sent by the client for registration.

```
{
    "firstName": "John",
    "lastName": "Doe",
    "username": "john",
    "email": "john@example.com"
}
```

<a href="src/main/java/com/usermanagement/dto/UserDto.java">User</a> sent by the client to log in.

```
{
    "username": "john",
    "password": "john_password"
}
```

### Security

This API uses JWT token to authenticate and authorize users to perform certain actions. Some actions do not need a
token.
(see <a href="src/main/java/com/usermanagement/utility/SecurityConstant.java#L13">URLS</a>)
<br><br>
<a href="src/main/java/com/usermanagement/configuration/SecurityConfiguration.java">Spring Security configuration</a>:

* Passwords are encrypted using
  <a href="src/main/java/com/usermanagement/configuration/SecurityConfiguration.java#L94">BCrypt encoder</a>
* An <a href="src/main/java/com/usermanagement/configuration/SecurityConfiguration.java#L135">authorization filter</a>
  is used to process each HTTP request.
* The <a href="src/main/java/com/usermanagement/filter/JwtAuthorizationFilter.java#L56">authorization filter</a>
  checks if the JWT token is valid and sets the spring security context accordingly.
* The spring security context is used in the <a href="src/main/java/com/usermanagement/controller">controller</a>
  to authenticate and authorize a user to perform certain actions.

### Software Architecture

There are 3 layers:

1. <a href="src/main/java/com/usermanagement/controller">Controller</a>
2. <a href="src/main/java/com/usermanagement/service">Service</a>
3. <a href="src/main/java/com/usermanagement/repository">JPA repository</a>

### Configuration

The <a href="src/main/resources/application.properties">application.properties</a> file contains the information needed
for the application to connect to a database (url, username, password).
<br>
The <a href="src/main/resources/email.properties">email.properties</a> file contains the information needed to connect
to the email account that will sent email to the user upon resetting the password.

### Database

The file <a href="sql/create.sql">create.sql<a/> is a script to create a user table and insert a
<a href="sql/create.sql#L58">special admin user</a>.
<br>
This special admin is not present in the list returned by
<a href="src/main/java/com/usermanagement/controller/UserController.java#L151">GET "/user/list"</a>
(see <a href="src/main/java/com/usermanagement/repository/UserRepository.java#L10">UserRepository</a>).
<br>
Moreover, this user cannot be modified or deleted through the API. Only its password can be reset.
